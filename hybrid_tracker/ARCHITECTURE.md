# ğŸ—ï¸ Hybrid Tracker - System Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     HYBRID TRACKER SYSTEM                        â”‚
â”‚                    (ROS 2 Humble Package)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INPUT SOURCES                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸ“· Camera Feed                    ğŸŒ Gazebo Simulation         â”‚
â”‚  /takipIHA/camera/image_raw        /gazebo/model_states         â”‚
â”‚  (sensor_msgs/Image)               (gazebo_msgs/ModelStates)    â”‚
â”‚  640x480 @ 30 Hz                   Position of dusmanIHA        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HYBRID TRACKER NODE                           â”‚
â”‚                  (hybrid_tracker_node.py)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              STATE MACHINE CONTROLLER                   â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  STATE A: VISUAL_TRACKING (Primary)             â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 1. cv_bridge: ROS Image â†’ OpenCV        â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 2. YOLOv8 Detector (vision/detector.py) â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 3. RobustTracker (vision/robust_tracker)â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 4. Kalman Update (vision/kalman_filter) â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 5. Calculate bbox center & size         â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Transition: Visual lost > 0.5s â†’ STATE B       â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                          â”‚                              â”‚    â”‚
â”‚  â”‚                          â–¼                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  STATE B: KALMAN_PREDICTION (Buffer: 3s)        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 1. Kalman.predict() â†’ (x, y)            â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 2. Continue re-detection attempts       â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 3. Use predicted position for control   â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Transitions:                                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  - Re-detected â†’ STATE A                        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  - Timeout (3s) â†’ STATE C                       â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                          â”‚                              â”‚    â”‚
â”‚  â”‚                          â–¼                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  STATE C: GROUND_TRUTH_SEARCH (Recovery)        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 1. Get dusmanIHA from model_states      â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 2. Extract (x, y, z) position           â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 3. Navigate directly to target          â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â”‚ 4. Attempt visual re-acquisition        â”‚   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  Transition: Visual contact â†’ STATE A            â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              CONTROL SYSTEM (30 Hz)                     â”‚    â”‚
â”‚  â”‚                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  PID Controllers (controllers/pid_controller.py) â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  1. Yaw PID:                                    â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     Error = center_x - image_center_x           â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     Output = angular.z (rad/s)                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     Goal: Center target horizontally            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  2. Pitch/Speed PID:                            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     Error = target_size - bbox_width            â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     Output = linear.x (m/s)                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     Goal: Maintain distance                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚  3. Altitude PID:                               â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     Error = center_y - image_center_y           â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     Output = linear.z (m/s)                     â”‚  â”‚    â”‚
â”‚  â”‚  â”‚     Goal: Match target height                   â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         OUTPUT                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ğŸš MAVROS Control Commands                                     â”‚
â”‚  /takipIHA/mavros/setpoint_velocity/cmd_vel_unstamped          â”‚
â”‚  (geometry_msgs/TwistStamped)                                   â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  twist.linear.x   = Forward/Backward speed (m/s)        â”‚  â”‚
â”‚  â”‚  twist.linear.y   = Left/Right speed (m/s)              â”‚  â”‚
â”‚  â”‚  twist.linear.z   = Up/Down speed (m/s)                 â”‚  â”‚
â”‚  â”‚  twist.angular.z  = Yaw rate (rad/s)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Module Dependencies

```
hybrid_tracker_node.py
â”œâ”€â”€ vision/
â”‚   â”œâ”€â”€ detector.py (UAVDetector)
â”‚   â”‚   â””â”€â”€ ultralytics.YOLO
â”‚   â”œâ”€â”€ tracker.py (ObjectTracker)
â”‚   â”‚   â””â”€â”€ cv2.Tracker*
â”‚   â”œâ”€â”€ robust_tracker.py (RobustTracker)
â”‚   â”‚   â””â”€â”€ tracker.ObjectTracker
â”‚   â””â”€â”€ kalman_filter.py (UAVKalmanFilter)
â”‚       â””â”€â”€ filterpy.kalman.KalmanFilter
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ pid_controller.py (PIDController)
â””â”€â”€ ROS 2 Dependencies
    â”œâ”€â”€ rclpy
    â”œâ”€â”€ cv_bridge
    â”œâ”€â”€ sensor_msgs
    â”œâ”€â”€ geometry_msgs
    â””â”€â”€ gazebo_msgs
```

## Data Flow

```
Camera Image (640x480)
    â”‚
    â”œâ”€â–º cv_bridge.imgmsg_to_cv2()
    â”‚
    â”œâ”€â–º YOLOv8.detect()
    â”‚       â”‚
    â”‚       â””â”€â–º Detections [bbox, conf, class]
    â”‚               â”‚
    â”‚               â””â”€â–º RobustTracker.init() / update()
    â”‚                       â”‚
    â”‚                       â””â”€â–º Bbox (x1, y1, x2, y2)
    â”‚                               â”‚
    â”‚                               â”œâ”€â–º Calculate center (cx, cy)
    â”‚                               â”œâ”€â–º Calculate size (w, h)
    â”‚                               â””â”€â–º Kalman.update((cx, cy))
    â”‚
    â””â”€â–º Control Calculations
            â”‚
            â”œâ”€â–º Yaw Error = cx - img_center_x
            â”‚       â””â”€â–º PID â†’ angular.z
            â”‚
            â”œâ”€â–º Size Error = target_size - w
            â”‚       â””â”€â–º PID â†’ linear.x
            â”‚
            â””â”€â–º Alt Error = cy - img_center_y
                    â””â”€â–º PID â†’ linear.z
                            â”‚
                            â””â”€â–º TwistStamped â†’ MAVROS
```

## Configuration Flow

```
tracker_params.yaml
    â”‚
    â”œâ”€â–º ROS 2 Parameter Server
    â”‚
    â””â”€â–º hybrid_tracker_node
            â”‚
            â”œâ”€â–º Detection Parameters
            â”‚   â”œâ”€â”€ model_path
            â”‚   â”œâ”€â”€ conf_threshold
            â”‚   â””â”€â”€ target_classes
            â”‚
            â”œâ”€â–º Tracking Parameters
            â”‚   â””â”€â”€ tracker_type
            â”‚
            â”œâ”€â–º PID Gains
            â”‚   â”œâ”€â”€ yaw_kp, yaw_ki, yaw_kd
            â”‚   â”œâ”€â”€ pitch_kp, pitch_ki, pitch_kd
            â”‚   â””â”€â”€ alt_kp, alt_ki, alt_kd
            â”‚
            â””â”€â–º Control Limits
                â”œâ”€â”€ max_yaw_rate
                â”œâ”€â”€ max_linear_speed
                â””â”€â”€ max_vertical_speed
```

## State Transition Diagram

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   SYSTEM START  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”Œâ”€â”€â”€â”€â–ºâ”‚ VISUAL_TRACKING â”‚â—„â”€â”€â”€â”€â”
              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
              â”‚              â”‚               â”‚
              â”‚              â”‚ Lost > 0.5s  â”‚
              â”‚              â–¼               â”‚
              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
              â”‚     â”‚KALMAN_PREDICTIONâ”‚     â”‚
              â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
              â”‚              â”‚               â”‚
              â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚              â”‚ Re-detected
              â”‚              â”‚
              â”‚              â”‚ Timeout (3s)
              â”‚              â–¼
              â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â””â”€â”€â”€â”€â”€â”¤GROUND_TRUTH     â”‚
                    â”‚    SEARCH       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Visual contact
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Timing Diagram

```
Time (ms)    0    33    66    100   133   166   200
             â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚
Camera       â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—  30 Hz
             â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚
Detection    â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—  10-15 Hz
             â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚
Tracking     â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—  30 Hz
             â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚
Kalman       â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—  30 Hz
             â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚
Control      â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—  30 Hz
             â”‚     â”‚     â”‚     â”‚     â”‚     â”‚     â”‚
MAVROS       â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—  30 Hz

Total Latency: ~100ms (camera â†’ control output)
```

## Performance Characteristics

```
Component          FPS    Latency   CPU Usage
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Camera Input       30     ~10ms     5%
YOLOv8 Detection   15-20  ~50ms     25%
OpenCV Tracking    30+    ~10ms     5%
Kalman Filter      30     ~1ms      1%
PID Control        30     ~1ms      1%
ROS 2 Overhead     -      ~20ms     3%
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL SYSTEM       30     ~100ms    40%
```

## Error Handling Flow

```
Error Detected
    â”‚
    â”œâ”€â–º Detection Failed
    â”‚       â””â”€â–º Continue with tracker
    â”‚               â””â”€â–º Tracker failed?
    â”‚                       â””â”€â–º Switch to Kalman
    â”‚
    â”œâ”€â–º Tracker Lost
    â”‚       â””â”€â–º Re-attempt detection
    â”‚               â””â”€â–º Failed?
    â”‚                       â””â”€â–º Switch to Kalman
    â”‚
    â”œâ”€â–º Kalman Timeout
    â”‚       â””â”€â–º Switch to Ground Truth
    â”‚               â””â”€â–º Navigate to GPS
    â”‚
    â””â”€â–º Ground Truth Unavailable
            â””â”€â–º Hover in place
                    â””â”€â–º Continue attempting recovery
```

---

This architecture provides:
- âœ… Robust multi-layer fallback
- âœ… Real-time performance (30 Hz)
- âœ… Modular, maintainable design
- âœ… Comprehensive error handling
- âœ… Production-ready implementation
